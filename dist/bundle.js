"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var canvas=require("canvas"),crypto=require("crypto"),fs=require("fs"),puppeteer=require("puppeteer"),chalk=_interopDefault(require("chalk")),path=require("path"),extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function __extends(e,t){function n(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function __awaiter(o,a,u,c){return new(u||(u=Promise))(function(e,t){function n(e){try{s(c.next(e))}catch(e){t(e)}}function r(e){try{s(c.throw(e))}catch(e){t(e)}}function s(t){t.done?e(t.value):new u(function(e){e(t.value)}).then(n,r)}s((c=c.apply(o,a||[])).next())})}function __generator(n,r){var s,o,a,e,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(s)throw new TypeError("Generator is already executing.");for(;u;)try{if(s=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return u.label++,{value:t[1],done:!1};case 5:u.label++,o=t[1],t=[0];continue;case 7:t=u.ops.pop(),u.trys.pop();continue;default:if(!(a=0<(a=u.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){u=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){u.label=t[1];break}if(6===t[0]&&u.label<a[1]){u.label=a[1],a=t;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(t);break}a[2]&&u.ops.pop(),u.trys.pop();continue}t=r.call(n,u)}catch(e){t=[6,e],o=0}finally{s=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function abortUselessRequests(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,t.setRequestInterception(!0)];case 1:return e.sent(),t.on("request",function(e){var t=e.resourceType();"media"===t||"image"===t||"font"===t||"stylesheet"===t?e.abort():e.continue()}),[2]}})})}function md5(e){return crypto.createHash("md5").update(e).digest("hex")}function combineRgba(e,t){var n=e[0],r=e[1],s=e[2],o=e[3],a=t[0],u=t[1],c=t[2],i=t[3],l=o+i-o*i;return[(n*o+a*i-n*o*i)/l,(r*o+u*i-r*o*i)/l,(s*o+c*i-s*o*i)/l,l]}function tolerance(e,t,n){var r=e[0],s=e[1],o=e[2],a=t[0],u=t[1],c=t[2];return a-n<r&&r<a+n&&u-n<s&&s<u+n&&c-n<o&&o<c+n}function encode(e){return Buffer.from(e).toString("base64")}function decode(e){return Buffer.from(e,"base64").toString("utf8")}var browser=null;function initBrowser(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,puppeteer.launch({headless:"1"!==process.env.DEBUG,defaultViewport:{width:1280,height:768}})];case 1:return browser=e.sent(),[2]}})})}function getBrowser(){return browser}var Auth=function(){function e(e){this.user=e,this.canAutoLogin=!1}return e.prototype.getSavedCookies=function(){var e=fs.readFileSync(this.getCookiePath()).toString();return JSON.parse(decode(e))},e.prototype.login=function(){return __awaiter(this,void 0,Promise,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return[4,puppeteer.launch({headless:this.canAutoLogin,defaultViewport:{width:1024,height:768}})];case 1:return[4,(t=e.sent()).newPage()];case 2:return n=e.sent(),[4,this._login(n)];case 3:return e.sent(),[4,n.cookies()];case 4:return r=e.sent(),fs.writeFileSync(this.getCookiePath(),encode(JSON.stringify(r))),[4,t.close()];case 5:return e.sent(),console.log("登录成功！"),[2]}})})},e.prototype.check=function(){return __awaiter(this,void 0,Promise,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,5,,6]),console.log("检查 Cookies 是否有效..."),t=this.getSavedCookies(),[4,getBrowser().newPage()];case 1:return[4,(n=e.sent()).setCookie.apply(n,t)];case 2:return e.sent(),[4,this._check(n)];case 3:return(r=e.sent())?console.log("Cookies 有效，直接登录"):console.log("Cookies 已失效，请重新登录"),[4,n.close()];case 4:return e.sent(),[2,r];case 5:return e.sent(),console.log("Cookies 未找到，请重新登录"),[2,!1];case 6:return[2]}})})},e}();function getVerifyPosition(t,l){return new Promise(function(u,e){var c=canvas.createCanvas(1e3,1e3).getContext("2d"),i=new canvas.Image;i.onload=function(){var e=i.naturalWidth,t=i.naturalHeight;c.drawImage(i,0,0);for(var n=[0,0,0,.65],r=null,s=0;s<e;s++){r=null;for(var o=0;o<t;o++){var a=c.getImageData(s,o,1,1).data;if(r){if(r[3]=1,tolerance(combineRgba(r,n),a,10))return void u(s*l/e)}else r=a}}u(0)},i.onerror=e,i.src=t})}var WebAuth=function(n){function e(e){var t=n.call(this,e)||this;return t.canAutoLogin=Boolean(e.password&&e.username),t}return __extends(e,n),e.prototype.getCookiePath=function(){return path.join(process.cwd(),"temp",md5("cookies-jd"+this.user.username))},e.prototype._login=function(g){return __awaiter(this,void 0,void 0,function(){var t,n,r,s,o,a,u,c,i,l,h,f;return __generator(this,function(e){switch(e.label){case 0:return[4,g.goto("https://passport.jd.com/new/login.aspx")];case 1:return e.sent(),[4,g.click(".login-tab.login-tab-r > a")];case 2:return e.sent(),this.user.username?[4,g.$eval("#loginname",function(e,t){return e.setAttribute("value",t)},this.user.username)]:[3,4];case 3:e.sent(),e.label=4;case 4:return this.user.password?[4,g.$eval("#nloginpwd",function(e,t){return e.setAttribute("value",t)},this.user.password)]:[3,6];case 5:e.sent(),e.label=6;case 6:return this.canAutoLogin?[4,g.click("#loginsubmit")]:[3,32];case 7:return e.sent(),[4,g.waitFor(1e3)];case 8:e.sent(),t=0,e.label=9;case 9:return(n=++t<20)?[4,g.$(".JDJRV-bigimg")]:[3,11];case 10:n=e.sent(),e.label=11;case 11:return n?(console.log("正在尝试通过验证码（第"+t+"次）"),[4,g.$(".JDJRV-bigimg > img")]):[3,32];case 12:return r=e.sent(),o=getVerifyPosition,[4,g.evaluate(function(e){return e.getAttribute("src")},r)];case 13:return a=[e.sent()],[4,g.evaluate(function(e){return parseInt(window.getComputedStyle(e).width)},r)];case 14:return[4,o.apply(void 0,a.concat([e.sent()]))];case 15:return s=e.sent(),[4,g.$(".JDJRV-slide-btn")];case 16:return u=e.sent(),[4,g.evaluate(function(e){var t=e.getBoundingClientRect();return{x:t.x,y:t.y,width:t.width,height:t.height}},u)];case 17:return c=e.sent(),i=c.x+c.width/2,l=c.y+c.height/2,10<s?(h=s-10,f=10,[4,g.mouse.move(i,l)]):[3,25];case 18:return e.sent(),[4,g.mouse.down()];case 19:return e.sent(),[4,g.mouse.move(i+h,l,{steps:30})];case 20:return e.sent(),[4,g.waitFor(500)];case 21:return e.sent(),[4,g.mouse.move(i+h+f,l,{steps:20})];case 22:return e.sent(),[4,g.waitFor(500)];case 23:return e.sent(),[4,g.mouse.up()];case 24:return e.sent(),[3,30];case 25:return[4,g.mouse.move(i,l)];case 26:return e.sent(),[4,g.mouse.down()];case 27:return e.sent(),[4,g.mouse.move(i+s,l,{steps:30})];case 28:return e.sent(),[4,g.mouse.up()];case 29:e.sent(),e.label=30;case 30:return[4,g.waitFor(3e3)];case 31:return e.sent(),[3,9];case 32:return[4,g.waitForFunction('window.location.href.indexOf("https://www.jd.com") >= 0',{timeout:0})];case 33:return e.sent(),[2]}})})},e.prototype._check=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,abortUselessRequests(t)];case 1:return e.sent(),[4,t.goto("https://order.jd.com/center/list.action")];case 2:return e.sent(),[4,t.$('body[myjd="_MYJD_ordercenter"]')];case 3:return[2,null!==e.sent()]}})})},e}(Auth),MobileAuth=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.getCookiePath=function(){return path.join(process.cwd(),"temp",md5("cookies-jd-m"+this.user.username))},e.prototype._login=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,t.goto("https://plogin.m.jd.com/user/login.action")];case 1:return e.sent(),this.user.username?[4,t.type("#username",this.user.username)]:[3,3];case 2:e.sent(),e.label=3;case 3:return this.user.password?[4,t.type("#password",this.user.password)]:[3,5];case 4:e.sent(),e.label=5;case 5:return[4,t.waitForFunction('window.location.href.indexOf("https://m.jd.com/") >= 0',{timeout:0})];case 6:return e.sent(),[2]}})})},e.prototype._check=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,t.goto("https://home.m.jd.com/myJd/newhome.action",{waitUntil:"networkidle0"})];case 1:return e.sent(),[4,t.$(".user_info")];case 2:return[2,null!==e.sent()]}})})},e}(Auth),error=chalk.bold.red,warn=chalk.keyword("orange"),success=chalk.green,mute=chalk.gray,Job=function(){function e(e){this.user=e,this.browser=getBrowser()}return e.prototype.run=function(){return __awaiter(this,void 0,Promise,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:if((t=this.user.skipJobs)&&0<=t.indexOf(this.name))return console.log("跳过【"+this.name+"】任务"),[2];console.log("开始【"+this.name+"】任务"),e.label=1;case 1:return e.trys.push([1,3,,8]),this.cookies=this.getCookies(this.user),[4,this._run()];case 2:return e.sent(),[3,8];case 3:n=e.sent(),console.log(error("任务失败，将重试一次"),error(n.message)),e.label=4;case 4:return e.trys.push([4,6,,7]),[4,this._run()];case 5:return e.sent(),[3,7];case 6:return r=e.sent(),console.log(error("任务失败"),error(r.message)),[3,7];case 7:return[3,8];case 8:return[2]}})})},e}(),WebJob=function(n){function e(e){var t=n.call(this,e)||this;return t.auth=new WebAuth(e),t}return __extends(e,n),e.prototype.getCookies=function(){return this.auth.getSavedCookies()},e}(Job),JingdouDaily=function(n){function e(e){var t=n.call(this,e)||this;return t.name="网页端每日签到",t}return __extends(e,n),e.prototype._run=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return[4,this.browser.newPage()];case 1:return[4,abortUselessRequests(t=e.sent())];case 2:return e.sent(),[4,t.setCookie.apply(t,this.cookies)];case 3:return e.sent(),[4,t.goto("https://vip.jd.com/sign/index")];case 4:return e.sent(),[4,t.$(".day-info.active > .active-info > .title")];case 5:return n=e.sent(),[4,t.evaluate(function(e){return e.textContent},n)];case 6:return 0<=(r=e.sent()).indexOf("获得")?console.log(success(r)):console.log(mute(r)),[4,t.close()];case 7:return e.sent(),[2]}})})},e}(WebJob),JingdouShops=function(n){function e(e){var t=n.call(this,e)||this;return t._run=function(){return __awaiter(t,void 0,void 0,function(){var t,n,r,s,o,a,u,c,i,l,h,f;return __generator(this,function(e){switch(e.label){case 0:return[4,this.browser.newPage()];case 1:return[4,abortUselessRequests(t=e.sent())];case 2:return e.sent(),[4,t.setCookie.apply(t,this.cookies)];case 3:return e.sent(),[4,t.goto("https://bean.jd.com/myJingBean/list")];case 4:return e.sent(),[4,t.waitFor(".bean-shop-list")];case 5:return e.sent(),[4,t.$$(".bean-shop-list > li")];case 6:n=e.sent(),r=0,e.label=7;case 7:return r<n.length?[4,n[r].$(".s-name > a")]:[3,29];case 8:return s=e.sent(),[4,t.evaluate(function(e){return e.textContent},s)];case 9:o=e.sent(),e.label=10;case 10:return e.trys.push([10,27,,28]),[4,t.evaluate(function(e){return e.getAttribute("href")},s)];case 11:return a=e.sent(),[4,this.browser.newPage()];case 12:return[4,abortUselessRequests(u=e.sent())];case 13:return e.sent(),[4,u.setCookie.apply(u,this.cookies)];case 14:return e.sent(),[4,u.goto(a)];case 15:return e.sent(),[4,u.waitFor(".jSign")];case 16:return e.sent(),[4,u.$(".unsigned")];case 17:return(c=e.sent())?[4,u.evaluate(function(e){return e.getAttribute("url")},c)]:[3,24];case 18:return i=e.sent(),[4,u.goto("https://"+i)];case 19:return e.sent(),[4,u.$(".jingdou")];case 20:return(l=e.sent())?[4,u.evaluate(function(e){return e.textContent},l)]:[3,22];case 21:return h=e.sent(),console.log(o,success(h)),[3,23];case 22:console.log(o,"颗粒无收"),e.label=23;case 23:return[3,25];case 24:console.log(o,mute("已签到")),e.label=25;case 25:return[4,u.close()];case 26:return e.sent(),[3,28];case 27:return f=e.sent(),console.log(o,error("任务失败"),error(f.message)),[3,28];case 28:return r++,[3,7];case 29:return[4,t.close()];case 30:return e.sent(),[2]}})})},t.name="网页端店铺每日签到",t}return __extends(e,n),e}(WebJob),devices=require("puppeteer/DeviceDescriptors"),MobileJob=function(n){function e(e){var t=n.call(this,e)||this;return t.auth=new MobileAuth(e),t}return __extends(e,n),e.prototype.getCookies=function(){return this.auth.getSavedCookies()},e.emulatePhone=function(t,n){return void 0===n&&(n="iPhone 7"),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,t.emulate(devices[n])];case 1:return e.sent(),[2]}})})},e.prototype.getCurrentBeanCount=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return[4,this.browser.newPage()];case 1:return[4,abortUselessRequests(t=e.sent())];case 2:return e.sent(),[4,t.setCookie.apply(t,this.cookies)];case 3:return e.sent(),[4,t.goto("https://bean.m.jd.com/")];case 4:return e.sent(),[4,t.$('span[type="Bold"]')];case 5:return n=e.sent(),[4,t.evaluate(function(e){return e.textContent},n)];case 6:return r=e.sent(),[4,t.close()];case 7:return e.sent(),[2,parseInt(r)]}})})},e}(Job),JingdouDailyMobile=function(n){function e(e){var t=n.call(this,e)||this;return t._run=function(){return __awaiter(t,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCurrentBeanCount()];case 1:return t=e.sent(),[4,this.browser.newPage()];case 2:return[4,abortUselessRequests(n=e.sent())];case 3:return e.sent(),[4,n.setCookie.apply(n,this.cookies)];case 4:return e.sent(),[4,n.goto("https://bean.m.jd.com/bean/signIndex.action")];case 5:return e.sent(),[4,this.getCurrentBeanCount()];case 6:return(r=e.sent())===t?console.log(mute("今日已签到")):console.log(success("签到成功，获得"+(r-t)+"个京豆")),[4,n.close()];case 7:return e.sent(),[2]}})})},t.name="移动端每日签到",t}return __extends(e,n),e}(MobileJob),JinrongDaily=function(n){function e(e){var t=n.call(this,e)||this;return t._run=function(){return __awaiter(t,void 0,void 0,function(){var t,n,r,s,o,a;return __generator(this,function(e){switch(e.label){case 0:return[4,this.browser.newPage()];case 1:return[4,abortUselessRequests(t=e.sent())];case 2:return e.sent(),[4,t.setCookie.apply(t,this.cookies)];case 3:return e.sent(),[4,t.goto("https://vip.jr.jd.com/")];case 4:return e.sent(),[4,t.$(".m-qian")];case 5:return n=e.sent(),[4,t.evaluate(function(e){return e.textContent},n)];case 6:return 0<=e.sent().indexOf("已签到")?(console.log(mute("已签到")),[3,13]):[3,7];case 7:return[4,t.click(".m-qian")];case 8:return e.sent(),[4,t.waitFor(1e3)];case 9:return e.sent(),[4,t.waitFor("#getRewardText")];case 10:return e.sent(),o=(s=t).evaluate,a=[function(e){return e.textContent}],[4,t.$("#getRewardText")];case 11:return[4,o.apply(s,a.concat([e.sent()]))];case 12:r=e.sent(),console.log(r?success(r):warn("未知签到状态")),e.label=13;case 13:return[4,t.close()];case 14:return e.sent(),[2]}})})},t.name="网页端金融每日签到",t}return __extends(e,n),e}(WebJob),DoubleSign=function(n){function e(e){var t=n.call(this,e)||this;return t._run=function(){return __awaiter(t,void 0,void 0,function(){var t,n,r,s,o,a,u,c,i,l,h;return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCurrentBeanCount()];case 1:return t=e.sent(),[4,this.browser.newPage()];case 2:return[4,(n=e.sent()).setCookie.apply(n,this.cookies)];case 3:return e.sent(),[4,n.goto("https://ljd.m.jd.com/countersign/receiveAward.json")];case 4:return e.sent(),o=(s=JSON).parse,u=(a=n).evaluate,c=[function(e){return e.textContent}],[4,n.$("pre")];case 5:return[4,u.apply(a,c.concat([e.sent()]))];case 6:return r=o.apply(s,[e.sent()]),i=r.res.code,l=r.res.data&&r.res.data[0],"0"!==i?[3,10]:l?[4,this.getCurrentBeanCount()]:[3,8];case 7:return(h=e.sent())===t?console.log(mute("今日已签到")):console.log(success("签到成功，获得"+(h-t)+"个京豆")),[3,9];case 8:console.log(mute("颗粒无收")),e.label=9;case 9:return[3,11];case 10:"DS102"===i?console.log(mute("活动未开始")):"DS103"===i?console.log(mute("活动已结束")):"DS104"===i?console.log(mute("颗粒无收")):"DS106"===i?console.log(mute("未完成双签")):console.log(error("未知状态"),error(i)),e.label=11;case 11:return[2]}})})},t.name="移动端双签",t}return __extends(e,n),e}(MobileJob);function doWheel(a){return __awaiter(this,void 0,void 0,function(){var t,n,r,s,o;return __generator(this,function(e){switch(e.label){case 0:return[4,a.$(".wheel_pointer_wrap")];case 1:return[4,e.sent().tap()];case 2:return e.sent(),[4,a.waitForResponse(function(e){return e.url().startsWith("https://api.m.jd.com/client.action?functionId=babelGetLottery")&&200===e.status()})];case 3:t=e.sent(),e.label=4;case 4:return e.trys.push([4,6,,7]),s=(r=JSON).parse,[4,t.text()];case 5:return n=s.apply(r,[e.sent().replace(/^jsonp2\(/,"").replace(/\)$/,"")]),console.log(success(n.promptMsg),success(n.prizeName)),[3,7];case 6:return o=e.sent(),console.log(error(o.message)),[3,7];case 7:return[2]}})})}var JingdouZhuanpanMobile=function(n){function e(e){var t=n.call(this,e)||this;return t._run=function(){return __awaiter(t,void 0,void 0,function(){var t,n,r,s,o,a,u,c,i,l,h,f;return __generator(this,function(e){switch(e.label){case 0:return[4,this.browser.newPage()];case 1:return[4,abortUselessRequests(t=e.sent())];case 2:return e.sent(),[4,t.setCookie.apply(t,this.cookies)];case 3:return e.sent(),[4,t.goto("https://bean.m.jd.com/")];case 4:return e.sent(),[4,t.addStyleTag({content:".modal{z-index: -1 !important;display: none !important;}"})];case 5:return e.sent(),[4,t.$x("//span[contains(text(), '转福利')]//ancestor::div[@accessible]")];case 6:return 0<(n=e.sent()).length?[4,n[0].tap()]:[3,21];case 7:return e.sent(),[4,t.waitForFunction('window.location.href.indexOf("https://pro.m.jd.com/mall/active/") >= 0')];case 8:return e.sent(),[4,t.waitFor(".wheel_chance")];case 9:return e.sent(),[4,t.waitForFunction('document.querySelector(".wheel_chance").textContent !== ""')];case 10:return e.sent(),o=(s=t).evaluate,a=[function(e){return e.textContent.replace(/[ \r\n]/g,"")}],[4,t.$(".wheel_chance_wrap")];case 11:return[4,o.apply(s,a.concat([e.sent()]))];case 12:return r=e.sent(),i=(c=t).evaluate,l=[function(e){return e.textContent}],[4,t.$(".wheel_chance")];case 13:return[4,i.apply(c,l.concat([e.sent()]))];case 14:return"0"!==(u=e.sent())?[3,15]:(console.log(mute(r)),[3,20]);case 15:console.log(success(r)),h=parseInt(u),f=0,e.label=16;case 16:return f<h?[4,doWheel(t)]:[3,20];case 17:return e.sent(),[4,t.reload({waitUntil:"networkidle0"})];case 18:e.sent(),e.label=19;case 19:return f++,[3,16];case 20:return[3,22];case 21:console.log(mute("未找到活动入口")),e.label=22;case 22:return[4,t.close()];case 23:return e.sent(),[2]}})})},t.name="移动端京豆转福利",t}return __extends(e,n),e}(MobileJob),FuliDailyMobile=function(n){function e(e){var t=n.call(this,e)||this;return t.name="移动端每日福利",t}return __extends(e,n),e.prototype._run=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r,s,o,a,u,c,i,l,h,f,g,p,d,b,w,_,v,m,y,k,x;return __generator(this,function(e){switch(e.label){case 0:return t="https://wqs.jd.com/promote/201712/mwelfare/m.html?logintag=#/main",[4,this.getCurrentBeanCount()];case 1:return n=e.sent(),[4,this.browser.newPage()];case 2:return r=e.sent(),[4,MobileJob.emulatePhone(r)];case 3:return e.sent(),[4,abortUselessRequests(r)];case 4:return e.sent(),[4,r.setCookie.apply(r,this.cookies)];case 5:return e.sent(),[4,r.goto(t,{waitUntil:"networkidle0"})];case 6:return e.sent(),console.log("执行签到..."),[4,r.$(".signDay_day_item.day_able")];case 7:return(s=e.sent())?[4,s.click()]:[3,14];case 8:return e.sent(),[4,r.waitForResponse(function(e){return e.url().startsWith("https://s.m.jd.com/activemcenter/muserwelfare/sign")})];case 9:o=e.sent(),e.label=10;case 10:return e.trys.push([10,12,,13]),c=(u=JSON).parse,[4,o.text()];case 11:return 0==(a=c.apply(u,[e.sent().replace(/^try{.+?\(/,"").replace(/\);.+$/,"")])).ret&&0<a.level?console.log(success("签到成功")):10==a.ret?console.log(warn("网络异常，请重试")):11==a.ret?console.log(mute("您已经签到过啦")):0<=[15,5,6,7,11,19].indexOf(1*a.ret)?console.log(warn("该小时奖品已发放完，请下个时段再过来哦")):0<=[3,4,10,25,21,22].indexOf(1*a.ret)?console.log(warn("奖品已发完，下次请早点来哦")):console.log(error("签到失败："+a.ret)),[3,13];case 12:return i=e.sent(),console.log(error(i.message)),[3,13];case 13:return[3,15];case 14:console.log(mute("今日已签到")),e.label=15;case 15:l=0,e.label=16;case 16:return[4,r.$$(".welfareTask_btn")];case 17:return 0<e.sent().length&&++l<5?[4,r.$$(".welfareTask_btn")]:[3,40];case 18:h=e.sent(),f=0,e.label=19;case 19:return f<h.length?(g=h[f],[4,r.evaluate(function(e){return e.textContent},g)]):[3,38];case 20:return"立即前往"!==(p=e.sent())?[3,35]:[4,this.browser.newPage()];case 21:return d=e.sent(),[4,MobileJob.emulatePhone(d)];case 22:return e.sent(),[4,abortUselessRequests(d)];case 23:return e.sent(),[4,d.setCookie.apply(d,this.cookies)];case 24:return e.sent(),[4,d.goto(t,{waitUntil:"networkidle0"})];case 25:return e.sent(),[4,d.$$(".welfareTask_btn")];case 26:return b=e.sent(),[4,d.$$(".welfareTask_info > p:first-child")];case 27:w=e.sent(),_=0,e.label=28;case 28:return _<b.length?(v=b[_],m=w[_],[4,d.evaluate(function(e){return e.textContent},v)]):[3,34];case 29:return y=e.sent(),[4,d.evaluate(function(e){return e.textContent},m)];case 30:return k=e.sent(),"立即前往"===y&&0<=k.indexOf("京豆")?(console.log("执行每日福利任务..."),[4,Promise.all([d.waitForNavigation({waitUntil:"networkidle0"}),v.click()])]):[3,33];case 31:return e.sent(),[4,d.close()];case 32:return e.sent(),[3,34];case 33:return _++,[3,28];case 34:return[3,37];case 35:return"点击领取"!==p?[3,37]:[4,g.click()];case 36:e.sent(),e.label=37;case 37:return f++,[3,19];case 38:return[4,r.reload({waitUntil:"networkidle0"})];case 39:return e.sent(),[3,16];case 40:return[4,this.getCurrentBeanCount()];case 41:return 0<(x=e.sent())-n&&console.log(success("共获得"+(x-n)+"京豆")),[4,r.close()];case 42:return e.sent(),[2]}})})},e}(MobileJob),JinrongZhuanqianMobile=function(n){function e(e){var t=n.call(this,e)||this;return t._run=function(){return __awaiter(t,void 0,void 0,function(){var t,n,r,s,o;return __generator(this,function(e){switch(e.label){case 0:return[4,this.browser.newPage()];case 1:return[4,(t=e.sent()).setCookie.apply(t,this.cookies)];case 2:return e.sent(),[4,t.goto("https://m.jr.jd.com/spe/qyy/hzq/index.html?usertype=1176&from=daka#/",{waitUntil:"networkidle0"})];case 3:return e.sent(),[4,t.waitForSelector(".gangbeng .btn",{visible:!0})];case 4:return e.sent(),[4,t.$(".gangbeng .btn")];case 5:return[4,e.sent().click()];case 6:return e.sent(),[4,t.waitForSelector(".am-modal-body .title",{visible:!0})];case 7:return e.sent(),s=(r=t).evaluate,o=[function(e){return e.textContent}],[4,t.$(".am-modal-body .title")];case 8:return[4,s.apply(r,o.concat([e.sent()]))];case 9:return 0<=(n=e.sent()).indexOf("明天再来")?console.log(mute(n)):console.log(success(n)),[4,t.close()];case 10:return e.sent(),[2]}})})},t.name="移动端金融赚钱签到",t}return __extends(e,n),e}(MobileJob),config=require(path.join(process.cwd(),"config/user.json")),users=config.jd;function _runMobileJobs(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,new JingdouDailyMobile(t).run()];case 1:return e.sent(),[4,new FuliDailyMobile(t).run()];case 2:return e.sent(),[4,new JingdouZhuanpanMobile(t).run()];case 3:return e.sent(),[4,new DoubleSign(t).run()];case 4:return e.sent(),[4,new JinrongZhuanqianMobile(t).run()];case 5:return e.sent(),[2]}})})}function _runWebJobs(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,new JingdouDaily(t).run()];case 1:return e.sent(),[4,new JingdouShops(t).run()];case 2:return e.sent(),[4,new JinrongDaily(t).run()];case 3:return e.sent(),[2]}})})}function runWebJobs(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,(t=new WebAuth(n)).check()];case 1:return e.sent()?[4,_runWebJobs(n)]:[3,3];case 2:return e.sent(),[3,6];case 3:return n.skipLogin?[3,6]:[4,t.login()];case 4:return e.sent(),[4,_runWebJobs(n)];case 5:e.sent(),e.label=6;case 6:return[2]}})})}function runMobileJobs(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,(t=new MobileAuth(n)).check()];case 1:return e.sent()?[4,_runMobileJobs(n)]:[3,3];case 2:return e.sent(),[3,6];case 3:return n.skipLogin?[3,6]:[4,t.login()];case 4:return e.sent(),[4,_runMobileJobs(n)];case 5:e.sent(),e.label=6;case 6:return[2]}})})}function jd(){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:console.log("开始【京东商城】任务"),t=0,e.label=1;case 1:return t<users.length?(n=users[t]).skip?[3,4]:(console.log("用户：",n.username),[4,runWebJobs(n)]):[3,5];case 2:return e.sent(),[4,runMobileJobs(n)];case 3:e.sent(),e.label=4;case 4:return t++,[3,1];case 5:return console.log("【京东商城】任务已全部完成"),console.log("-----------------"),[2]}})})}var WebAuth$1=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.getCookiePath=function(){return path.join(process.cwd(),"temp",md5("cookies-v2ex"+this.user.username))},e.prototype._login=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,t.goto("https://www.v2ex.com/signin")];case 1:return e.sent(),this.user.username?[4,t.type(".sl",this.user.username)]:[3,3];case 2:e.sent(),e.label=3;case 3:return this.user.password?[4,t.type('.sl[type="password"]',this.user.password)]:[3,5];case 4:e.sent(),e.label=5;case 5:return[4,t.waitForFunction('window.location.href === "https://www.v2ex.com/"',{timeout:0})];case 6:return e.sent(),[2]}})})},e.prototype._check=function(c){return __awaiter(this,void 0,void 0,function(){var t,n,r,s,o,a,u;return __generator(this,function(e){switch(e.label){case 0:return[4,abortUselessRequests(c)];case 1:return e.sent(),[4,c.goto("https://www.v2ex.com/mission/daily")];case 2:return e.sent(),[4,c.$('input[type="button"].super.normal.button')];case 3:return t=e.sent(),[4,c.evaluate(function(e){return e.getAttribute("value")},t)];case 4:return n=e.sent(),t&&0<=n.indexOf("领取")?[4,c.evaluate(function(){return document.body.innerHTML})]:[3,8];case 5:return r=e.sent(),s=r.match(/已连续登录 \d+ 天/),[4,Promise.all([c.waitForNavigation(),t.click()])];case 6:return e.sent(),[4,c.evaluate(function(){return document.body.innerHTML})];case 7:return o=e.sent(),a=o.match(/已连续登录 \d+ 天/),(u=a[0]!==s[0])&&console.log(success("签到成功")),[2,u];case 8:return[2,!0]}})})},e}(Auth),WebJob$1=function(n){function e(e){var t=n.call(this,e)||this;return t.auth=new WebAuth$1(e),t}return __extends(e,n),e.prototype.getCookies=function(){return this.auth.getSavedCookies()},e}(Job),DailySign=function(n){function e(e){var t=n.call(this,e)||this;return t._run=function(){return __awaiter(t,void 0,void 0,function(){var t,n,r,s,o;return __generator(this,function(e){switch(e.label){case 0:return[4,this.browser.newPage()];case 1:return[4,abortUselessRequests(t=e.sent())];case 2:return e.sent(),[4,t.setCookie.apply(t,this.cookies)];case 3:return e.sent(),[4,t.goto("https://www.v2ex.com/mission/daily")];case 4:return e.sent(),[4,t.$('input[type="button"].super.normal.button')];case 5:return n=e.sent(),[4,t.evaluate(function(e){return e.getAttribute("value")},n)];case 6:return r=e.sent(),n&&0<=r.indexOf("领取")?[4,Promise.all([t.waitForNavigation(),n.click()])]:[3,9];case 7:return e.sent(),[4,t.evaluate(function(){return document.body.innerHTML})];case 8:return s=e.sent(),o=s.match(/已连续登录 \d+ 天/),console.log(success(o[0])),[3,11];case 9:return[4,t.evaluate(function(){return document.body.innerHTML})];case 10:s=e.sent(),o=s.match(/已连续登录 \d+ 天/),console.log(mute(o[0])),e.label=11;case 11:return[4,t.close()];case 12:return e.sent(),[2]}})})},t.name="每日签到",t}return __extends(e,n),e}(WebJob$1),users$1=config.v2ex;function _runWebJobs$1(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,new DailySign(t).run()];case 1:return e.sent(),[2]}})})}function runWebJobs$1(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,(t=new WebAuth$1(n)).check()];case 1:return e.sent()?[4,_runWebJobs$1(n)]:[3,3];case 2:return e.sent(),[3,6];case 3:return n.skipLogin?[3,6]:[4,t.login()];case 4:return e.sent(),[4,_runWebJobs$1(n)];case 5:e.sent(),e.label=6;case 6:return[2]}})})}function v2ex(){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:console.log("开始【V2EX】任务"),t=0,e.label=1;case 1:return t<users$1.length?(n=users$1[t]).skip?[3,3]:(console.log("用户：",n.username),[4,runWebJobs$1(n)]):[3,4];case 2:e.sent(),e.label=3;case 3:return t++,[3,1];case 4:return console.log("【V2EX】任务已全部完成"),console.log("-----------------"),[2]}})})}function main(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t=path.join(process.cwd(),"temp"),!fs.existsSync(t)&&fs.mkdirSync(t),[4,initBrowser()];case 1:return e.sent(),[4,jd()];case 2:return e.sent(),[4,v2ex()];case 3:return e.sent(),[2]}})})}main().then(function(){console.log("done."),process.exit(0)}).catch(function(e){console.error(e),process.exit(1)});
